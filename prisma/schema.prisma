// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model Cliente {
  id            String   @db.VarChar(36) @id @default(uuid())
  nome          String   @db.VarChar(60)
  cpf           String   @db.VarChar(11) @unique
  rg            String   @db.VarChar(10)
  email         String   @db.VarChar(40) @unique
  dataNasc      DateTime 
  estadoCivil   EstadoCivil
  profissao     String   @db.VarChar(30)
  senha         String   @db.VarChar(60)     // senha deve ser varchar(60)
  ativo         Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt  
  contatos      Contato[]
  residencias   Residencia[]
  moradores     Morador[]
  visitas       Visita[]
  prestadores   Prestador[]
  veiculos      Veiculo[]
  pagamentos    Pagamento[]
  encomendas    Encomendas[]
  reservas      Reserva[]
  votos Voto[]
  recuperaSenhas RecuperaSenha[]
  sugestoes    Sugestao[]
  @@map("clientes")
}


model Admin {
  id            String   @db.VarChar(36) @id @default(uuid())
  nome          String   @db.VarChar(60)
  cpf           String   @db.VarChar(11) @unique
  email         String   @db.VarChar(40) @unique
  senha         String   @db.VarChar(60)   // senha deve ser varchar(60)
  nivel         Int      @db.SmallInt @default(2)
  ativo         Boolean  @default(true) 
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt  
  logs          Log[]
  avisos        Aviso[]
  votacoes Votacao[]
  @@map("admins")
}

model Log {
  id            Int         @id @default(autoincrement())
  admin         Admin       @relation(fields: [adminId], references: [id])
  adminId       String      @db.VarChar(36)
  descricao     String      @db.VarChar(60)
  complemento   String      @db.VarChar(200)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@map("logs")
}

model Contato{
  id            Int         @id @default(autoincrement())
  email         String      @db.VarChar(40)
  telefone      String      @db.VarChar(15)
  whatsapp      String      @db.VarChar(15)
  cliente       Cliente     @relation(fields: [clienteId], references: [id])
  clienteId     String      @db.VarChar(36)
  @@map("contatos")
}

model Residencia {
  id            Int      @id @default(autoincrement())
  numeroCasa    String   @db.VarChar(3)
  rua           String   @db.VarChar(30)
  proprietario  String   @db.VarChar(60)
  dataResidencia DateTime 
  Tipo          Tipo
  cliente       Cliente     @relation(fields: [clienteId], references: [id])
  clienteId     String      @db.VarChar(36)
  veiculos      Veiculo[]
  moradores     Morador[]
  visitas       Visita[]
  prestadores   Prestador[]
  @@map("residencias")
}

model Morador {
  id            Int      @id @default(autoincrement())
  nome          String   @db.VarChar(60)
  parentesco    String   @db.VarChar(30)
  dataNasc      DateTime 
  cpf           String   @db.VarChar(11)
  email         String?   @db.VarChar(40)
  contato       String   @db.VarChar(15)
  residencia    Residencia @relation(fields: [residenciaId], references: [id])
  residenciaId  Int
  tipoMorador   TipoMorador
  cliente       Cliente  @relation(fields: [clienteId], references: [id])
  clienteId     String   @db.VarChar(36)
  @@map("moradores")
}

model Veiculo{
  id            Int      @id @default(autoincrement())
  marca         String   @db.VarChar(30)
  modelo        String   @db.VarChar(30)
  ano           Int      @db.SmallInt
  cor           String   @db.VarChar(20)
  placa         String   @db.VarChar(7)
  proprietario  String   @db.VarChar(60)
  residencia    Residencia @relation(fields: [residenciaId], references: [id])
  residenciaId  Int
  garagem       String   @db.VarChar(3)
  TipoVeiculo    TipoVeiculo
  cliente       Cliente  @relation(fields: [clienteId], references: [id])
  clienteId     String   @db.VarChar(36)
  @@map("veiculos")
}

model Pagamento{
  id            Int      @id @default(autoincrement())
  boletos       String   @db.VarChar(60)
  dataVencimento DateTime 
  status        StatusPagamento
  valor         Float    @db.Real
  dataPagamento DateTime 
  metodoPagamento MetodoPagamento
  cliente       Cliente  @relation(fields: [clienteId], references: [id])
  clienteId     String   @db.VarChar(36)
  @@map("pagamentos")
}

model Visita{
  id            Int      @id @default(autoincrement())
  nome          String   @db.VarChar(60)
  cpf           String   @db.VarChar(11)
  contato       String   @db.VarChar(15)
  dataVisita    DateTime 
  horario       String   @db.VarChar(5)
  observacoes   String?   @db.VarChar(255)
  residencia    Residencia @relation(fields: [residenciaId], references: [id])
  residenciaId  Int
  cliente       Cliente  @relation(fields: [clienteId], references: [id])
  clienteId     String   @db.VarChar(36)
  @@map("visitas")
}

model Prestador{
  id            Int      @id @default(autoincrement())
  nome          String   @db.VarChar(60)
  cpf           String   @db.VarChar(14)
  contato       String   @db.VarChar(15)
  email        String?   @db.VarChar(40) 
  residencia    Residencia @relation(fields: [residenciaId], references: [id])
  residenciaId  Int
  servico       String   @db.VarChar(60)
  dataServico   DateTime 
  horario       String   @db.VarChar(5)
  observacoes   String?   @db.VarChar(255)
  cliente       Cliente  @relation(fields: [clienteId], references: [id])
  clienteId     String   @db.VarChar(36)
  @@map("prestadores")
}

model Encomendas{
  id            Int      @id @default(autoincrement())
  nome          String   @db.VarChar(60)    
  codigo        String?  @db.VarChar(10)  
  remetente     String   @db.VarChar(60)
  codigorastreio String?  @db.VarChar(30)
  tamanho       String   @db.VarChar(10)
  clienteId     String   @db.VarChar(36)
  cliente       Cliente  @relation(fields: [clienteId], references: [id])
  status          StatusEncomenda   @default(AGUARDANDO_RETIRADA)
  dataChegada     DateTime          @default(now())
  dataRetirada    DateTime?
  adminRegistroId String?           @db.VarChar(36)
  adminEntregaId  String?           @db.VarChar(36)
  @@map("encomendas")
}

model Reserva {
  id            Int      @id @default(autoincrement())
  area          String   @db.VarChar(60)
  dataReserva   DateTime 
  valor         Float    @db.Real
  status        StatusReserva
  capacidade    Int      @db.SmallInt
  horario       String   @db.VarChar(5)
  clienteId     String   @db.VarChar(36)
  cliente       Cliente  @relation(fields: [clienteId], references: [id])
  @@map("reservas")
}

model Aviso{
  id            Int      @id @default(autoincrement())
  titulo        String   @db.VarChar(60)
  descricao     String   @db.VarChar(255)
  data          DateTime @default(now())
  adminId     String   @db.VarChar(36)
  admin       Admin    @relation(fields: [adminId], references: [id])
  @@map("avisos")
}

model Votacao {
  id          Int      @id @default(autoincrement())
  titulo      String   @db.VarChar(60)
  descricao   String   @db.VarChar(255)
  dataInicio  DateTime
  dataFim     DateTime
  status      StatusVotacao @default(AGENDADA)
  adminId     String   @db.VarChar(36)
  admin       Admin    @relation(fields: [adminId], references: [id])
  opcoes      OpcaoVotacao[]
  votos       Voto[]

  @@map("votacoes")
}

model OpcaoVotacao {
  id          Int      @id @default(autoincrement())
  texto       String   @db.VarChar(100)
  votacaoId   Int
  votacao     Votacao  @relation(fields: [votacaoId], references: [id], onDelete: Cascade)
  votos       Voto[]
  @@map("opcoes_votacao")
}

model Voto {
  id          Int      @id @default(autoincrement())
  votacaoId   Int
  votacao     Votacao  @relation(fields: [votacaoId], references: [id], onDelete: Cascade)
  opcaoId     Int
  opcao       OpcaoVotacao @relation(fields: [opcaoId], references: [id], onDelete: Cascade)
  clienteId   String   @db.VarChar(36)
  cliente     Cliente  @relation(fields: [clienteId], references: [id])
  dataVoto    DateTime @default(now())
  @@unique([votacaoId, clienteId])
  @@map("votos")
}

model RecuperaSenha{
  id            Int      @id @default(autoincrement())
  clienteId     String   @db.VarChar(36)
  cliente       Cliente  @relation(fields: [clienteId], references: [id])
  token         String   @db.VarChar(255)
  createdAt     DateTime @default(now())
  expiresAt     DateTime
  @@map("recupera_senha")
}

model Sugestao{
  id            Int      @id @default(autoincrement())
  titulo        String   @db.VarChar(60)
  descricao     String   @db.VarChar(255)
  data          DateTime @default(now())
  clienteId     String   @db.VarChar(36)
  cliente     Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  @@map("sugestoes")
}


enum MetodoPagamento {
  CREDITO
  DEBITO
  BOLETO
  PIX
}

enum StatusPagamento {
  PENDENTE
  PAGO
  ATRASADO
  CANCELADO
}

enum StatusReserva {
  CONFIRMADA
  PENDENTE
  CANCELADA
}

enum StatusVotacao {
  EM_ANDAMENTO
  FINALIZADA
  AGENDADA
  CANCELADA
}

enum StatusEncomenda {
  AGUARDANDO_RETIRADA
  ENTREGUE
}

enum EstadoCivil {
  SOLTEIRO
  CASADO
  DIVORCIADO
  VIUVO
}

enum TipoMorador {
  PROPRIETARIO
  INQUILINO
}

enum Tipo {
  CASA
  APARTAMENTO
}

enum TipoVeiculo {
  CARRO
  MOTO
}